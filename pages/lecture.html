---
layout: default
title: Lecture
permalink: /lecture/
---

<div class="lecture-detail" id="lecture-container">
  <div class="loading">Loading lecture details...</div>
</div>

<script>
  // Get lecture slug from URL query parameter
  const urlParams = new URLSearchParams(window.location.search);
  const slug = urlParams.get('slug');
  
  if (!slug) {
    document.getElementById('lecture-container').innerHTML = '<div class="error">No lecture specified</div>';
  } else {
    loadLecture(slug);
  }
  
  async function loadLecture(slug) {
    try {
      // Load data-loader helper if not already loaded
      if (typeof DataLoader === 'undefined') {
        await loadScript('{{ "/assets/data/data-loader.js" | relative_url }}');
      }
      // Ensure base URL respects Jekyll baseurl
      if (typeof DataLoader !== 'undefined') {
        DataLoader.baseUrl = '{{ site.baseurl }}/assets/data';
      }
      
      const lecture = await DataLoader.loadLecture(slug);
      
      if (!lecture) {
        document.getElementById('lecture-container').innerHTML = '<div class="error">Lecture not found</div>';
        return;
      }
      
      renderLecture(lecture);
    } catch (error) {
      console.error('Error loading lecture:', error);
      document.getElementById('lecture-container').innerHTML = '<div class="error">Error loading lecture</div>';
    }
  }
  
  function loadScript(src) {
    return new Promise((resolve, reject) => {
      const script = document.createElement('script');
      script.src = src;
      script.onload = resolve;
      script.onerror = reject;
      document.head.appendChild(script);
    });
  }
  
  function renderLecture(lecture) {
    const container = document.getElementById('lecture-container');
    
    // Format date
    const dateStr = lecture.date ? new Date(lecture.date).toLocaleDateString('en-GB', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    }) : 'Date TBA';
    
    // Build speakers HTML
      const speakersHTML = lecture.speakers && lecture.speakers.length > 0
        ? lecture.speakers.map(s => `<a href="{{ '/speaker/' | relative_url }}?slug=${s.slug}" class="speaker-link">${s.name}</a>`).join(', ')
        : 'Speaker TBA';
    
    // Build topics HTML
    const topicsHTML = lecture.topics && lecture.topics.length > 0
      ? lecture.topics.map(t => `<a href="{{ '/topic/' | relative_url }}?id=${t.id}" class="topic-tag">${t.name}</a>`).join(' ')
      : '';
    
    // Build venue HTML
    const venueHTML = lecture.venue
      ? `<a href="{{ '/institution/' | relative_url }}?slug=${lecture.venue.slug}" class="venue-link">${lecture.venue.name}</a>${lecture.venue.city ? ', ' + lecture.venue.city : ''}`
      : 'Venue TBA';
    
    // Build organizer HTML
    const organizerHTML = lecture.organizer
      ? `<a href="{{ '/institution/' | relative_url }}?slug=${lecture.organizer.slug}" class="organizer-link">${lecture.organizer.name}</a>`
      : '';
    
    // Build additional dates HTML
    let additionalDatesHTML = '';
    if (lecture.dates && lecture.dates.length > 1) {
      additionalDatesHTML = `
        <div class="additional-dates">
          <h3>Additional Dates</h3>
          <ul class="dates-list">
            ${lecture.dates.slice(1).map(d => {
              const dStr = new Date(d.from_date).toLocaleDateString('en-GB', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              });
              const timeStr = d.time !== '00:00:00' ? ` at ${d.time.substring(0, 5)}` : '';
              const venueStr = d.venue ? ` - ${d.venue.name}` : '';
              return `<li>${dStr}${timeStr}${venueStr}</li>`;
            }).join('')}
          </ul>
        </div>
      `;
    }
    
    // Get image URL
    const imageUrl = lecture.image_id 
      ? `{{ '/assets/images/sm/' | relative_url }}${lecture.image_id}.jpg`
      : `{{ '/assets/images/supercategories/' | relative_url }}${lecture.supercategory}.jpg`;
    
    container.innerHTML = `
      <div class="container">
        <div class="lecture-header">
          <div class="lecture-meta">
            <span class="supercategory-badge" data-category="${lecture.supercategory}">${lecture.supercategory}</span>
            <span class="lecture-date">${dateStr}</span>
          </div>
          
          <h1 class="lecture-title">${lecture.title}</h1>
          
          <div class="lecture-speakers">
            ${speakersHTML}
          </div>
          
          ${topicsHTML ? `<div class="lecture-topics">${topicsHTML}</div>` : ''}
        </div>
        
        <div class="lecture-content">
          <div class="lecture-main">
            ${lecture.image_id ? `
              <div class="lecture-image">
                <img src="${imageUrl}" alt="${lecture.title}" onerror="this.style.display='none'">
              </div>
            ` : ''}
            
            ${lecture.synopsis ? `
              <div class="lecture-synopsis">
                <h2>Synopsis</h2>
                <p>${lecture.synopsis}</p>
              </div>
            ` : ''}
            
            ${lecture.body ? `
              <div class="lecture-body">
                <h2>Description</h2>
                <div class="lecture-text">${lecture.body.replace(/\r\n/g, '<br><br>')}</div>
              </div>
            ` : ''}
            
            ${lecture.additional_info ? `
              <div class="lecture-additional">
                <h3>Additional Information</h3>
                <p>${lecture.additional_info}</p>
              </div>
            ` : ''}
            
            ${lecture.keywords ? `
              <div class="lecture-keywords">
                <strong>Keywords:</strong> ${lecture.keywords}
              </div>
            ` : ''}
            
            ${additionalDatesHTML}
          </div>
          
          <aside class="lecture-sidebar">
            <div class="info-box">
              <h3>Event Details</h3>
              
              <div class="info-item">
                <strong>Venue:</strong>
                <div>${venueHTML}</div>
              </div>
              
              ${organizerHTML ? `
                <div class="info-item">
                  <strong>Organized by:</strong>
                  <div>${organizerHTML}</div>
                </div>
              ` : ''}
              
              ${lecture.duration ? `
                <div class="info-item">
                  <strong>Duration:</strong>
                  <div>${lecture.duration} minutes</div>
                </div>
              ` : ''}
              
              ${lecture.dates && lecture.dates[0] && lecture.dates[0].ticket_cost ? `
                <div class="info-item">
                  <strong>Ticket Cost:</strong>
                  <div>${lecture.dates[0].ticket_cost}</div>
                </div>
              ` : ''}
              
              ${lecture.dates && lecture.dates[0] && lecture.dates[0].ticket_info ? `
                <div class="info-item">
                  <strong>Tickets:</strong>
                  <div><a href="${lecture.dates[0].ticket_info}" target="_blank" rel="noopener">Book tickets</a></div>
                </div>
              ` : ''}
              
              ${lecture.dates && lecture.dates[0] && lecture.dates[0].members_only === 'Yes' ? `
                <div class="info-item members-only">
                  <strong>Members Only</strong>
                  ${lecture.dates[0].members_info ? `<div>${lecture.dates[0].members_info}</div>` : ''}
                </div>
              ` : ''}
            </div>
            
            ${lecture.venue && lecture.venue.postcode ? `
              <div class="info-box">
                <h3>Location</h3>
                <div class="location-info">
                  ${lecture.venue.name}<br>
                  ${lecture.venue.city || ''}<br>
                  ${lecture.venue.postcode}
                </div>
              </div>
            ` : ''}
          </aside>
        </div>
      </div>
    `;
    
    // Update page title
    document.title = `${lecture.title} - The Lecture List`;
  }
</script>

<style>
  .lecture-detail {
    padding: 2rem 0;
  }
  
  .lecture-header {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e0e0e0;
  }

  .lecture-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  
  .supercategory-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: #007bff;
    color: white;
    border-radius: 4px;
    font-size: 0.875rem;
    text-transform: capitalize;
  }
  
  .lecture-date {
    color: #666;
    font-size: 0.875rem;
  }
  
  .lecture-title {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.2;
  }
  
  .lecture-speakers {
    font-size: 1.25rem;
    margin-bottom: 1rem;
  }
  
  .speaker-link {
    color: #007bff;
    text-decoration: none;
  }
  
  .speaker-link:hover {
    text-decoration: underline;
  }
  
  .lecture-topics {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .topic-tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: #f0f0f0;
    color: #333;
    border-radius: 4px;
    font-size: 0.875rem;
    text-decoration: none;
  }
  
  .topic-tag:hover {
    background: #e0e0e0;
  }
  
  .lecture-content {
    display: grid;
    grid-template-columns: 1fr 300px;
    gap: 2rem;
  }
  
  @media (max-width: 768px) {
    .lecture-content {
      grid-template-columns: 1fr;
    }
  }
  
  .lecture-main {
    min-width: 0;
  }
  
  .lecture-image {
    margin: 0 1.5rem 1rem 0;
    padding:1rem 1rem 1rem 0;
    width: 33%;
    float: left;
    border-right:1px solid #ccc;
  }

  .lecture-image img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }
  
  .lecture-synopsis,
  .lecture-body,
  .lecture-additional,
  .additional-dates {
    margin-bottom: 2rem;
  }
  
  .lecture-synopsis h2,
  .lecture-body h2,
  .additional-dates h3 {
    margin-bottom: 1rem;
  }
  
  .lecture-text {
    line-height: 1.6;
  }
  
  .lecture-keywords {
    padding: 1rem;
    background: #f9f9f9;
    border-left: 4px solid #007bff;
    margin-top: 1rem;
  }
  
  .dates-list {
    list-style: none;
    padding: 0;
  }
  
  .dates-list li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .dates-list li:last-child {
    border-bottom: none;
  }
  
  .lecture-sidebar {
    min-width: 0;
  }
  
  .info-box {
    background: #f9f9f9;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
  }
  
  .info-box h3 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1.25rem;
  }
  
  .info-item {
    margin-bottom: 1rem;
  }
  
  .info-item:last-child {
    margin-bottom: 0;
  }
  
  .info-item strong {
    display: block;
    margin-bottom: 0.25rem;
    color: #666;
    font-size: 0.875rem;
  }
  
  .venue-link,
  .organizer-link {
    color: #007bff;
    text-decoration: none;
  }
  
  .venue-link:hover,
  .organizer-link:hover {
    text-decoration: underline;
  }
  
  .members-only {
    background: #fff3cd;
    padding: 0.75rem;
    border-radius: 4px;
  }
  
  .location-info {
    line-height: 1.6;
  }
  
  .loading,
  .error {
    padding: 2rem;
    text-align: center;
    color: #666;
  }
  
  .error {
    color: #dc3545;
  }
</style>
