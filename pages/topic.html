---
layout: default
title: Topic
permalink: /topic/
---

<div class="topic-detail" id="topic-container">
  <div class="loading">Loading topic details...</div>
</div>

<script>
  // Get topic ID from URL query parameter
  const urlParams = new URLSearchParams(window.location.search);
  const topicId = parseInt(urlParams.get('id'));
  
  if (!topicId) {
    document.getElementById('topic-container').innerHTML = '<div class="error">No topic specified</div>';
  } else {
    loadTopic(topicId);
  }
  
  async function loadTopic(topicId) {
    try {
      // Load topic data
      const topicsResponse = await fetch('{{ "/assets/data/topics.json" | relative_url }}');
      const topics = await topicsResponse.json();
      
      const topic = topics.find(t => t.id === topicId);
      
      if (!topic) {
        document.getElementById('topic-container').innerHTML = '<div class="error">Topic not found</div>';
        return;
      }
      
      // Load lectures for this topic
      const lecturesResponse = await fetch('{{ "/assets/data/lectures.json" | relative_url }}');
      const allLectures = await lecturesResponse.json();
      
      const topicLectures = allLectures.filter(lecture => 
        lecture.topics && lecture.topics.some(t => t.id === topicId)
      );
      
      // Find related topics (same path prefix)
      const pathPrefix = topic.path.split('/').slice(0, -1).join('/');
      const relatedTopics = topics.filter(t => 
        t.id !== topicId && 
        t.path.startsWith(pathPrefix) &&
        t.path !== topic.path
      ).slice(0, 10);
      
      renderTopic(topic, topicLectures, relatedTopics);
    } catch (error) {
      console.error('Error loading topic:', error);
      document.getElementById('topic-container').innerHTML = '<div class="error">Error loading topic</div>';
    }
  }
  
  function renderTopic(topic, lectures, relatedTopics) {
    const container = document.getElementById('topic-container');
    
    // Sort lectures by date (most recent first)
    lectures.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    // Get unique speakers
    const speakersMap = new Map();
    lectures.forEach(lecture => {
      if (lecture.speakers) {
        lecture.speakers.forEach(speaker => {
          if (!speakersMap.has(speaker.id)) {
            speakersMap.set(speaker.id, speaker);
          }
        });
      }
    });
    const uniqueSpeakers = Array.from(speakersMap.values());
    
    // Get unique venues
    const venuesMap = new Map();
    lectures.forEach(lecture => {
      if (lecture.venue) {
        if (!venuesMap.has(lecture.venue.id)) {
          venuesMap.set(lecture.venue.id, lecture.venue);
        }
      }
    });
    const uniqueVenues = Array.from(venuesMap.values());
    
    container.innerHTML = `
      <div class="container">
        <div class="topic-header">
          <div class="topic-breadcrumb">
            <a href="{{ '/topics/' | relative_url }}">Topics</a>
            ${topic.path.split('/').filter(p => p).slice(0, -1).map(p => 
              `<span class="breadcrumb-sep">â€º</span><span class="breadcrumb-item">${p}</span>`
            ).join('')}
          </div>
          
          <h1 class="topic-name">${topic.name}</h1>
          <p class="topic-path">${topic.path}</p>
        </div>
        
        <div class="topic-stats">
          <div class="stat-card">
            <div class="stat-number">${lectures.length}</div>
            <div class="stat-label">Lectures</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${uniqueSpeakers.length}</div>
            <div class="stat-label">Speakers</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${uniqueVenues.length}</div>
            <div class="stat-label">Venues</div>
          </div>
        </div>
        
        ${relatedTopics.length > 0 ? `
          <div class="related-topics">
            <h3>Related Topics</h3>
            <div class="topic-tags">
              ${relatedTopics.map(t => `
                <a href="{{ '/topic/' | relative_url }}?id=${t.id}" class="topic-tag">${t.name}</a>
              `).join('')}
            </div>
          </div>
        ` : ''}
        
        <div class="topic-lectures">
          <h2>Lectures (${lectures.length})</h2>
          <div class="lectures-list">
            ${lectures.map(lecture => {
              const dateStr = lecture.date ? new Date(lecture.date).toLocaleDateString('en-GB', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
              }) : 'Date TBA';
              
              return `
                <div class="lecture-item">
                  <div class="lecture-item-header">
                    <h3 class="lecture-item-title">
                      <a href="{{ '/lecture/' | relative_url }}?slug=${lecture.slug}">${lecture.title}</a>
                    </h3>
                    <span class="lecture-item-date">${dateStr}</span>
                  </div>
                  ${lecture.speakers && lecture.speakers.length > 0 ? `
                    <div class="lecture-item-speakers">
                      ${lecture.speakers.map(s => 
                        `<a href="{{ '/speaker/' | relative_url }}?slug=${s.slug}" class="speaker-link">${s.name}</a>`
                      ).join(', ')}
                    </div>
                  ` : ''}
                  ${lecture.synopsis ? `<p class="lecture-item-synopsis">${lecture.synopsis}</p>` : ''}
                  <div class="lecture-item-meta">
                    ${lecture.venue ? `<span class="venue-name"><a href="{{ '/institution/' | relative_url }}?slug=${lecture.venue.slug}">${lecture.venue.name}</a></span>` : ''}
                    ${lecture.supercategory ? `<span class="category-badge" data-category="${lecture.supercategory}">${lecture.supercategory}</span>` : ''}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      </div>
    `;
    
    // Update page title
    document.title = `${topic.name} - The Lecture List`;
  }
</script>

<style>
  .topic-detail {
    padding: 2rem 0;
  }
  
  .topic-header {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .topic-breadcrumb {
    margin-bottom: 1rem;
    font-size: 0.875rem;
    color: #666;
  }
  
  .topic-breadcrumb a {
    color: #007bff;
    text-decoration: none;
  }
  
  .topic-breadcrumb a:hover {
    text-decoration: underline;
  }
  
  .breadcrumb-sep {
    margin: 0 0.5rem;
    color: #ccc;
  }
  
  .breadcrumb-item {
    text-transform: capitalize;
  }
  
  .topic-name {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    text-transform: capitalize;
  }
  
  .topic-path {
    font-family: monospace;
    color: #666;
    font-size: 0.875rem;
  }
  
  .topic-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  
  .stat-card {
    background: #f9f9f9;
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
  }
  
  .stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #007bff;
    margin-bottom: 0.5rem;
  }
  
  .stat-label {
    color: #666;
    font-size: 0.875rem;
  }
  
  .related-topics {
    margin-bottom: 2rem;
  }
  
  .related-topics h3 {
    margin-bottom: 1rem;
  }
  
  .topic-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .topic-tag {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: #f0f0f0;
    color: #333;
    border-radius: 4px;
    text-decoration: none;
    transition: background 0.2s;
  }
  
  .topic-tag:hover {
    background: #e0e0e0;
  }
  
  .topic-lectures h2 {
    margin-bottom: 1.5rem;
  }
  
  .lectures-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .lecture-item {
    padding: 1.5rem;
    background: #f9f9f9;
    border-radius: 8px;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  
  .lecture-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .lecture-item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 0.5rem;
  }
  
  .lecture-item-title {
    margin: 0;
    font-size: 1.25rem;
    flex: 1;
  }
  
  .lecture-item-title a {
    color: #333;
    text-decoration: none;
  }
  
  .lecture-item-title a:hover {
    color: #007bff;
  }
  
  .lecture-item-date {
    color: #666;
    font-size: 0.875rem;
    white-space: nowrap;
  }
  
  .lecture-item-speakers {
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
  }
  
  .speaker-link {
    color: #007bff;
    text-decoration: none;
  }
  
  .speaker-link:hover {
    text-decoration: underline;
  }
  
  .lecture-item-synopsis {
    margin: 0.5rem 0;
    color: #666;
    line-height: 1.5;
  }
  
  .lecture-item-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-top: 0.75rem;
  }
  
  .venue-name a {
    color: #666;
    text-decoration: none;
  }
  
  .venue-name a:hover {
    color: #007bff;
    text-decoration: underline;
  }
  
  .category-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: #007bff;
    color: white;
    border-radius: 4px;
    font-size: 0.75rem;
    text-transform: capitalize;
  }
  
  .loading,
  .error {
    padding: 2rem;
    text-align: center;
    color: #666;
  }
  
  .error {
    color: #dc3545;
  }
  
  @media (max-width: 768px) {
    .lecture-item-header {
      flex-direction: column;
    }
    
    .lecture-item-date {
      align-self: flex-start;
    }
  }
</style>

