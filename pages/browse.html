---
layout: page
title: Browse Lectures
permalink: /browse/
---

<div class="browse-controls">
  <div class="filter-group">
    <label for="category-filter">Category:</label>
    <select id="category-filter" class="filter-select">
      <option value="">All Categories</option>
    </select>
  </div>
  
  <div class="filter-group">
    <label for="sort-select">Sort by:</label>
    <select id="sort-select" class="filter-select">
      <option value="date-desc">Newest First</option>
      <option value="date-asc">Oldest First</option>
      <option value="title-asc">Title (A-Z)</option>
      <option value="title-desc">Title (Z-A)</option>
    </select>
  </div>
  
  <div class="results-count">
    <span id="loading-indicator">Loading lectures...</span>
    <span id="results-count" style="display:none;">Showing <strong>0</strong> lectures</span>
  </div>
</div>

<div id="lecture-list" class="lecture-grid">
  <!-- Lectures will be loaded here -->
</div>

<div class="pagination">
  <button id="load-more" class="btn btn-primary" style="display:none;">Load More</button>
</div>

<script>
// Client-side filtering and pagination
(async function() {
  let allLectures = [];
  let filteredLectures = [];
  let displayedCount = 24;
  
  const categoryFilter = document.getElementById('category-filter');
  const sortSelect = document.getElementById('sort-select');
  const lectureList = document.getElementById('lecture-list');
  const resultsCount = document.getElementById('results-count');
  const loadingIndicator = document.getElementById('loading-indicator');
  const loadMoreBtn = document.getElementById('load-more');
  
  // Get URL parameters
  const urlParams = new URLSearchParams(window.location.search);
  const initialCategory = urlParams.get('category') || '';
  
  // Load data
  try {
    // Load lectures
    const lecturesResponse = await fetch('{{ "/assets/data/lectures.json" | relative_url }}');
    allLectures = await lecturesResponse.json();
    
    // Load supercategories for the dropdown
    const categoriesResponse = await fetch('{{ "/assets/data/supercategories.json" | relative_url }}');
    const categories = await categoriesResponse.json();
    
    // Populate category dropdown
    categories.forEach(cat => {
      const option = document.createElement('option');
      option.value = cat.slug;
      option.textContent = cat.name;
      if (cat.slug === initialCategory) {
        option.selected = true;
      }
      categoryFilter.appendChild(option);
    });
    
    // Hide loading, show results
    loadingIndicator.style.display = 'none';
    resultsCount.style.display = 'block';
    
    // Initial filter and render
    filterLectures();
    
  } catch (error) {
    console.error('Error loading lectures:', error);
    loadingIndicator.textContent = 'Error loading lectures. Please refresh the page.';
    loadingIndicator.style.color = 'red';
  }
  
  function filterLectures() {
    const category = categoryFilter.value;
    
    filteredLectures = allLectures.filter(lecture => {
      if (category && lecture.supercategory !== category) return false;
      return true;
    });
    
    sortLectures();
  }
  
  function sortLectures() {
    const sortBy = sortSelect.value;
    
    filteredLectures.sort((a, b) => {
      switch(sortBy) {
        case 'date-desc':
          // Sort by actual lecture date, not added date
          return (b.date || '').localeCompare(a.date || '');
        case 'date-asc':
          return (a.date || '').localeCompare(b.date || '');
        case 'title-asc':
          return a.title.localeCompare(b.title);
        case 'title-desc':
          return b.title.localeCompare(a.title);
        default:
          return 0;
      }
    });
    
    displayedCount = 24;
    renderLectures();
  }
  
  function renderLectures() {
    const toDisplay = filteredLectures.slice(0, displayedCount);
    
    lectureList.innerHTML = toDisplay.map(lecture => {
      // Format date
      const dateStr = lecture.date ? new Date(lecture.date).toLocaleDateString('en-GB', {
        day: 'numeric',
        month: 'short',
        year: 'numeric'
      }) : 'Date TBA';
      
      // Format speakers
      const speakers = lecture.speakers && lecture.speakers.length > 0
        ? lecture.speakers.slice(0, 2).map(s => `<a href="{{ '/speaker/' | relative_url }}?slug=${s.slug}" class="speaker-link">${s.name}</a>`).join(', ')
        : '';
      const moreCount = lecture.speakers && lecture.speakers.length > 2 ? ` +${lecture.speakers.length - 2} more` : '';
      
      // Format venue
      const venue = lecture.venue 
        ? `<a href="{{ '/institution/' | relative_url }}?slug=${lecture.venue.slug}" class="venue-link">${lecture.venue.name}</a>`
        : '';
      
      return `
        <article class="lecture-card">
          <div class="lecture-card-header">
            <span class="lecture-card-category" data-category="${lecture.supercategory}">${lecture.supercategory}</span>
            <time class="lecture-card-date">${dateStr}</time>
          </div>
          <div class="lecture-card-content">
            <h3 class="lecture-card-title">
              <a href="{{ '/lecture/' | relative_url }}?slug=${lecture.slug}">${lecture.title}</a>
            </h3>
            ${speakers ? `<div class="lecture-card-speakers">${speakers}${moreCount}</div>` : ''}
            ${lecture.synopsis ? `<p class="lecture-card-synopsis">${lecture.synopsis.substring(0, 150)}${lecture.synopsis.length > 150 ? '...' : ''}</p>` : ''}
            <div class="lecture-card-meta">
              ${venue ? `<span class="lecture-venue">${venue}</span>` : ''}
              ${lecture.duration ? `<span class="lecture-duration">${lecture.duration} min</span>` : ''}
            </div>
          </div>
        </article>
      `;
    }).join('');
    
    // Update results count
    resultsCount.querySelector('strong').textContent = filteredLectures.length;
    
    // Show/hide load more button
    loadMoreBtn.style.display = displayedCount >= filteredLectures.length ? 'none' : 'block';
  }
  
  categoryFilter.addEventListener('change', () => {
    // Update URL when category changes
    const category = categoryFilter.value;
    const newUrl = category 
      ? `${window.location.pathname}?category=${category}`
      : window.location.pathname;
    window.history.pushState({}, '', newUrl);
    
    filterLectures();
  });
  
  sortSelect.addEventListener('change', sortLectures);
  
  loadMoreBtn.addEventListener('click', () => {
    displayedCount += 24;
    renderLectures();
  });
})();
</script>

<style>
  .browse-controls {
    display: flex;
    gap: 2rem;
    align-items: center;
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: #f9f9f9;
    border-radius: 8px;
    flex-wrap: wrap;
  }
  
  .filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .filter-group label {
    font-weight: 600;
    color: #666;
  }
  
  .filter-select {
    padding: 0.5rem 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    background: white;
    font-size: 1rem;
  }
  
  .results-count {
    margin-left: auto;
    color: #666;
  }
  
  #loading-indicator {
    color: #007bff;
  }
  
  .lecture-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
  }
  
  .lecture-card {
    background: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  
  .lecture-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  
  .lecture-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f9f9f9;
    border-bottom: 1px solid #e0e0e0;
  }
  
  .lecture-card-category {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: #007bff;
    color: white;
    border-radius: 4px;
    font-size: 0.75rem;
    text-transform: capitalize;
  }
  
  .lecture-card-date {
    font-size: 0.875rem;
    color: #666;
  }
  
  .lecture-card-content {
    padding: 1.5rem;
  }
  
  .lecture-card-title {
    margin: 0 0 0.75rem 0;
    font-size: 1.25rem;
    line-height: 1.3;
  }
  
  .lecture-card-title a {
    color: #333;
    text-decoration: none;
  }
  
  .lecture-card-title a:hover {
    color: #007bff;
  }
  
  .lecture-card-speakers {
    margin-bottom: 0.75rem;
    font-size: 0.875rem;
  }
  
  .speaker-link {
    color: #007bff;
    text-decoration: none;
  }
  
  .speaker-link:hover {
    text-decoration: underline;
  }
  
  .lecture-card-synopsis {
    margin: 0 0 0.75rem 0;
    color: #666;
    font-size: 0.875rem;
    line-height: 1.5;
  }
  
  .lecture-card-meta {
    display: flex;
    gap: 1rem;
    font-size: 0.75rem;
    color: #999;
  }
  
  .venue-link {
    color: #666;
    text-decoration: none;
  }
  
  .venue-link:hover {
    color: #007bff;
    text-decoration: underline;
  }
  
  .pagination {
    text-align: center;
    margin: 2rem 0;
  }
  
  .btn {
    padding: 0.75rem 2rem;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
    transition: background 0.2s;
  }
  
  .btn-primary {
    background: #007bff;
    color: white;
  }
  
  .btn-primary:hover {
    background: #0056b3;
  }
</style>

